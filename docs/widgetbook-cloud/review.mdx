# Review (beta)

> **NOTE:** Since the Review feature is currently in beta, we're not aiming to migrate any data created previous to the official (non-beta) release to make changes to the feature easier for our development team.

The Widgetbook Cloud _Review_ feature (currently in beta) allows teams to review added, changed or removed components.
The Review feature closely relates to reviews known from Pull-Requests. 
For each Pull-Request, our new `widgetbook` CLI analyzes the changes to your Widgetbook and creates a review.
Members of a frontend-team now can review each _changed_ use-case in isolation and add comments for other team members.

Once all changes from the review are accepted, a developer closes the Pull-Request and the review's status gets updated to `merged`.
For this to work, a webhook to our services is required.

## Requirements

To use Widgetbook Cloud _Review_ your setup has to meet the following requirements:
- Use [widgetbook_generator package](https://pub.dev/packages/widgetbook_generator) in version `v3.0.0-beta` (no special configuration required).
- Use [widgetbook package](https://pub.dev/packages/widgetbook) in version `v3.0.0-beta` (no special configuration required).
- Use the `widgetbook` CLI from the [widgetbook_cli package](https://pub.dev/packages/widgetbook_cli).
- Setup a GitHub webhook

# How the Review feature works

In a pull request (sometimes called merge request) developers compare a _base_ branch (sometimes called _base ref_) with a _feature_ branch (sometimes called _head_ branch or _head ref_) based on the lines of code changed.
The Widgetbook Review feature has some similarities to how pull requests work. 
Therefore, for each pull request Widgetbook Cloud creates a Review that corresponds to a pull request in your Git provider.
Similar to how the base code is compared to the head code on a line by line basis, in Widgetbook Cloud teams compare a base build with a head build on a visual use-case basis.
Therefore, Widgetbook Cloud requires an uploaded build for the base branch and feature branch.

## Builds for review
Use the [widgetbook_cli package](https://pub.dev/packages/widgetbook_cli) to upload a build for the base and feature branch. 
We recommend to have a first pipeline that runs whenever a new commit is pushed to your base branch (e.g. `main`, `dev`, `staging`). 
In addition, we recommend to have a second pipeline that runs whenever a new commit is pushed to the pull request (and its feature branch).
In comparison to the first pipeline, the second pipeline should specify the base branch by using the `--base-branch` argument. 
The described configuration ensures that builds are available for the base and feature branches. 

## Review information

In addition to the required builds, a review has to be populated with information about which use-cases changed.
The information on which use-cases changed is extracted by the CLI when the `--base-branch` argument is specified.

<Info>
    Widgetbook Cloud shows Reviews for each pull-request. 
    However, only Reviews that have changes to use-cases are accessible.
</Info>

<Warning>
    Currently, Widgetbook Cloud only shows use-cases that have been changed, added or removed within the freature branch in comparison to the base branch. 
    That means, that already existing use-cases will not be shown even if they have never been reviewed.
</Warning>

## Setup Webhook (GitHub)

A GitHub Webhook allows Widgetbook Cloud to receive information about changes within your repository.
Widgetbook Cloud can automatically set the state of a Review to `closed` or `merged` when a corresponding Pull-Request is `closed` or `merged`.
For this to work, you need to configure a webhook. 
See [Setting up a webhook](https://docs.github.com/en/developers/webhooks-and-events/webhooks/creating-webhooks#setting-up-a-webhook) for instructions on how to do this.

### Requirements

You need to meet the following requirements to setup a webhook to Widgetbook Cloud:
- Webhook Secret
- Payload URL

### Obtaining the Webhook Secret

The webhook secret can be obtained by going to the project overview and click the `Get secret` button within the webhook card.

### Setting up the webhook

1. Go to https://github.com/user-name/repo-name/settings/hooks. Make sure to replace `user-name` and `repo-name` with your appropriate values.
1. Click `Add webhook`
1. Paste `https://api.widgetbook.io/v1/webhooks/github` into the `Payload URL` field.
1. Set `Content type` to `application/json`
1. Paste your Widgetbook Cloud webhook secret into the `Secret` field.
1. Select when to trigger the webhook.
    1. Select `Send me everything` or
    2. Select `Let me select individual events` and enable `Pull requests` and `Pushes`. You can disable all other options. 
